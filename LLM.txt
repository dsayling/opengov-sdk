ğ•Œ1.0.complete@2026-01-13
Î³â‰”opengov.sdk.usage
Ïâ‰”âŸ¨installation,configuration,endpoints,pagination,errorsâŸ©
âŠ¢TypeSafeâˆ§Functionalâˆ§DRY

;; â”€â”€â”€ Î©: METALOGIC â”€â”€â”€
âŸ¦Î©:FoundationâŸ§{
  SDKâ‰œopengov_api
  Patternâ‰œfunctional_factory
  Configâ‰œmodule_level_state
  HTTPâ‰œhttpx.Client
  âˆ€call:Type_Safeâˆ§Error_Wrapped
}

;; â”€â”€â”€ Î£: GLOSSARY â”€â”€â”€
âŸ¦Î£:GlossaryâŸ§{
  ;; Installation
  Installâ‰œ"uv add opengov-api" | "pip install opengov-api"

  ;; Configuration
  APIKeyâ‰œğ•Š; Communityâ‰œğ•Š; BaseURLâ‰œğ•Š; Timeoutâ‰œâ„âº
  Configâ‰œâŸ¨api_key:APIKey,community:Community,base_url:BaseURL?,timeout:Timeout?âŸ©

  ;; Core Types
  Resourceâ‰œâŸ¨id:ğ•Š,type:ğ•Š,attributes:Object,relationships?:ObjectâŸ©
  JSONAPIResponseâ‰œâŸ¨data:Resource|ListâŸ¨ResourceâŸ©,meta?:Object,links?:ObjectâŸ©

  ;; Operations
  Listâ‰œÎ».JSONAPIResponseâŸ¨ListâŸ©
  Getâ‰œÎ»id.dict
  Createâ‰œÎ»data.dict
  Updateâ‰œÎ»(id,data).dict
  Deleteâ‰œÎ»id.dict
  Iteratorâ‰œÎ».GeneratorâŸ¨ResourceâŸ©

  ;; Errors
  ErrorTreeâ‰œAPIErrorâŠƒ{ConfigError,ConnectionErrorâŠƒTimeoutError,StatusErrorâŠƒ{BadRequest,Unauthorized,Forbidden,NotFound,RateLimit,ServerError},ParseError}
}

;; â”€â”€â”€ Î£: TYPE UNIVERSE â”€â”€â”€
âŸ¦Î£:TypesâŸ§{
  ;; Primitives
  ğ”¹â‰œbool; â„•â‰œint; â„â‰œfloat; ğ•Šâ‰œstr

  ;; SDK Types
  dictâ‰œdict[str,Any]
  JSONAPIResponse[T]â‰œdict  ;; {"data": T | List[T], "meta"?: {...}, "links"?: {...}}

  ;; Domain Models
  Recordâ‰œâŸ¨id:ğ•Š,name:ğ•Š,status:RecordStatus,type_id:ğ•Š,attributes:dictâŸ©
  Userâ‰œâŸ¨id:ğ•Š,email:ğ•Š,name:ğ•Š,roles:ListâŸ¨ğ•ŠâŸ©âŸ©
  Locationâ‰œâŸ¨id:ğ•Š,address:ğ•Š,coordinates?:CoordsâŸ©
  RecordTypeâ‰œâŸ¨id:ğ•Š,name:ğ•Š,description:ğ•Š,enabled:ğ”¹âŸ©
  DocumentStepâ‰œâŸ¨id:ğ•Š,kind:StepKind,status:StepStatusâŸ©

  ;; Enums
  RecordStatusâ‰œ{ACTIVE,ARCHIVED,WITHDRAWN,WITHDRAWN_BY_STAFF}
  StepKindâ‰œ{approval,fee,inspection,document_upload}
  DocumentTypeâ‰œ{pdf,image,spreadsheet}
}

;; â”€â”€â”€ Î›: INSTALLATION â”€â”€â”€
âŸ¦Î›:InstallâŸ§{
  ;; Package Manager
  uvâ‰œ"uv add opengov-api"
  pipâ‰œ"pip install opengov-api"

  ;; Import
  importâ‰œ"import opengov_api"
  from_importâ‰œ"from opengov_api import list_records, get_record"
}

;; â”€â”€â”€ Î›: CONFIGURATION â”€â”€â”€
âŸ¦Î›:ConfigâŸ§{
  ;; Required Setup
  setupâ‰œ{
    opengov_api.set_api_key("your-api-key-here"),
    opengov_api.set_community("your-community-id")
  }

  ;; Environment Variables (Alternative)
  env_setupâ‰œ{
    export OPENGOV_API_KEY="your-api-key-here",
    export OPENGOV_COMMUNITY="your-community-id"
  }

  ;; Optional Configuration
  optionalâ‰œ{
    opengov_api.set_base_url("https://custom-api.opengov.com/v2"),
    opengov_api.set_timeout(60.0)
  }

  ;; Getters
  get_configâ‰œ{
    opengov_api.get_api_key(),
    opengov_api.get_community(),
    opengov_api.get_base_url(),
    opengov_api.get_timeout()
  }

  ;; Rules
  âˆ€operation:requires(api_key)âˆ§requires(community)
  âˆ€call:Configâ‰¡snapshot(module_state)
}

;; â”€â”€â”€ Î›: RECORDS API â”€â”€â”€
âŸ¦Î›:RecordsâŸ§{
  ;; List Records
  list_records:ListParams?â†’JSONAPIResponse[ListâŸ¨RecordâŸ©]
  list_recordsâ‰œÎ»params?.opengov_api.list_records(
    page=1,
    per_page=25,
    status="ACTIVE",
    type_id="permit-type-123",
    updated_since="2024-01-01"
  )

  ;; Iterate All Records (Pagination)
  iter_records:ListParams?â†’IteratorâŸ¨RecordâŸ©
  iter_recordsâ‰œÎ»params?.opengov_api.iter_records(
    status="ACTIVE"
  )
  # Usage: for record in opengov_api.iter_records(): ...

  ;; Get Single Record
  get_record:ğ•Šâ†’dict
  get_recordâ‰œÎ»id.opengov_api.get_record("record-id-123")

  ;; Create Record
  create_record:dictâ†’dict
  create_recordâ‰œÎ»data.opengov_api.create_record({
    "data": {
      "type": "records",
      "attributes": {
        "name": "New Permit Application",
        "type_id": "permit-type-123"
      }
    }
  })

  ;; Update Record
  update_record:(ğ•Š,dict)â†’dict
  update_recordâ‰œÎ»(id,data).opengov_api.update_record(
    "record-id-123",
    {"data": {"attributes": {"status": "ARCHIVED"}}}
  )

  ;; Archive Record (Delete)
  archive_record:ğ•Šâ†’dict
  archive_recordâ‰œÎ»id.opengov_api.archive_record("record-id-123")

  ;; Nested Resources - Applicant
  get_record_applicant:ğ•Šâ†’dict
  get_record_applicantâ‰œÎ»id.opengov_api.get_record_applicant("record-id-123")

  update_record_applicant:(ğ•Š,dict)â†’dict
  update_record_applicantâ‰œÎ»(id,data).opengov_api.update_record_applicant(
    "record-id-123",
    {"data": {"type": "users", "id": "user-456"}}
  )

  ;; Nested Resources - Guests
  list_record_guests:ğ•Šâ†’JSONAPIResponse[ListâŸ¨UserâŸ©]
  iter_record_guests:ğ•Šâ†’IteratorâŸ¨UserâŸ©
  add_record_guest:(ğ•Š,dict)â†’dict
  remove_record_guest:(ğ•Š,ğ•Š)â†’dict

  ;; Nested Resources - Locations
  get_record_primary_location:ğ•Šâ†’dict
  update_record_primary_location:(ğ•Š,dict)â†’dict
  remove_record_primary_location:ğ•Šâ†’dict
  list_record_additional_locations:ğ•Šâ†’JSONAPIResponse[ListâŸ¨LocationâŸ©]
  iter_record_additional_locations:ğ•Šâ†’IteratorâŸ¨LocationâŸ©

  ;; Nested Resources - Workflow Steps
  list_record_workflow_steps:ğ•Šâ†’JSONAPIResponse[ListâŸ¨WorkflowStepâŸ©]
  iter_record_workflow_steps:ğ•Šâ†’IteratorâŸ¨WorkflowStepâŸ©
  create_record_workflow_step:(ğ•Š,dict)â†’dict
  update_record_workflow_step:(ğ•Š,ğ•Š,dict)â†’dict
  delete_record_workflow_step:(ğ•Š,ğ•Š)â†’dict

  ;; Nested Resources - Collections
  list_record_collections:ğ•Šâ†’JSONAPIResponse[ListâŸ¨CollectionâŸ©]
  iter_record_collections:ğ•Šâ†’IteratorâŸ¨CollectionâŸ©
}

;; â”€â”€â”€ Î›: USERS API â”€â”€â”€
âŸ¦Î›:UsersâŸ§{
  list_users:ListParams?â†’JSONAPIResponse[ListâŸ¨UserâŸ©]
  get_user:ğ•Šâ†’dict
  create_user:dictâ†’dict
  list_user_flags:ğ•Šâ†’JSONAPIResponse[ListâŸ¨FlagâŸ©]
}

;; â”€â”€â”€ Î›: LOCATIONS API â”€â”€â”€
âŸ¦Î›:LocationsâŸ§{
  list_locations:ListParams?â†’JSONAPIResponse[ListâŸ¨LocationâŸ©]
  get_location:ğ•Šâ†’dict
  create_location:dictâ†’dict
  update_location:(ğ•Š,dict)â†’dict
}

;; â”€â”€â”€ Î›: DOCUMENTS API â”€â”€â”€
âŸ¦Î›:DocumentsâŸ§{
  list_document_steps:ListParams?â†’JSONAPIResponse[ListâŸ¨DocumentStepâŸ©]
  get_document_step:ğ•Šâ†’dict
  create_document_step:dictâ†’dict
  update_document_step:(ğ•Š,dict)â†’dict
}

;; â”€â”€â”€ Î›: RECORD TYPES API â”€â”€â”€
âŸ¦Î›:RecordTypesâŸ§{
  list_record_types:ListParams?â†’JSONAPIResponse[ListâŸ¨RecordTypeâŸ©]
  get_record_type:ğ•Šâ†’dict
}

;; â”€â”€â”€ Î“: PAGINATION PATTERN â”€â”€â”€
âŸ¦Î“:PaginationâŸ§{
  ;; Manual Pagination
  manualâ‰œ{
    page_1â‰œlist_records(page=1, per_page=25),
    page_2â‰œlist_records(page=2, per_page=25),
    ...
  }

  ;; Automatic Iteration (Recommended)
  autoâ‰œ{
    for record in iter_records(status="ACTIVE"):
        process(record)
  }

  ;; List Comprehension
  comprehensionâ‰œ[r["id"] for r in iter_records()]

  ;; Rules
  âˆ€list_*:returns single page
  âˆ€iter_*:auto-paginates all pages
  iter_*â‰œGeneratorâ†’lazy evaluation
}

;; â”€â”€â”€ Î“: ERROR HANDLING â”€â”€â”€
âŸ¦Î“:ErrorsâŸ§{
  ;; Exception Hierarchy
  APIErrorâ‰œBaseException
  â”œâ”€ConfigError        ;; Missing API key or community
  â”œâ”€ConnectionError    ;; Network failure
  â”‚ â””â”€TimeoutError     ;; Request timeout
  â”œâ”€StatusError        ;; HTTP status errors
  â”‚ â”œâ”€BadRequest(400)
  â”‚ â”œâ”€Unauthorized(401)
  â”‚ â”œâ”€Forbidden(403)
  â”‚ â”œâ”€NotFound(404)
  â”‚ â”œâ”€RateLimit(429)
  â”‚ â””â”€ServerError(5xx)
  â””â”€ParseError         ;; Invalid JSON response

  ;; Basic Error Handling
  basicâ‰œtry{
    recordâ‰œget_record("123")
  }catch opengov_api.APIError as e{
    print(f"API error: {e.message}")
  }

  ;; Specific Error Handling
  specificâ‰œtry{
    recordâ‰œget_record("123")
  }catch opengov_api.NotFound{
    print("Record not found")
  }catch opengov_api.Unauthorized{
    print("Invalid API key")
  }catch opengov_api.APIError as e{
    print(f"Other error: {e}")
  }

  ;; Error Context Access
  contextâ‰œtry{
    update_record("123", data)
  }catch opengov_api.StatusError as e{
    print(f"Status: {e.status_code}"),
    print(f"Body: {e.body}"),
    print(f"Request ID: {e.request_id}")
  }

  ;; Configuration Error
  config_errorâ‰œtry{
    list_records()  # Without setting config
  }catch opengov_api.ConfigError as e{
    print(f"Missing: {e.missing_field}"),
    opengov_api.set_api_key("key"),
    opengov_api.set_community("community")
  }
}

;; â”€â”€â”€ Î£: USAGE EXAMPLES â”€â”€â”€
âŸ¦Î£:ExamplesâŸ§{
  ;; Complete Example
  completeâ‰œ{
    # 1. Setup
    import opengov_api,
    opengov_api.set_api_key("your-api-key"),
    opengov_api.set_community("your-community"),

    # 2. List records with filters
    responseâ‰œopengov_api.list_records(
      status="ACTIVE",
      per_page=50
    ),
    recordsâ‰œresponse["data"],

    # 3. Iterate all records (auto-pagination)
    for record in opengov_api.iter_records(status="ACTIVE"){
      print(record["id"])
    },

    # 4. Get single record
    recordâ‰œopengov_api.get_record("record-123"),
    print(record["data"]["attributes"]["name"]),

    # 5. Create record
    new_recordâ‰œopengov_api.create_record({
      "data": {
        "type": "records",
        "attributes": {
          "name": "New Application",
          "type_id": "permit-type-123"
        }
      }
    }),

    # 6. Update record
    updatedâ‰œopengov_api.update_record(
      new_record["data"]["id"],
      {"data": {"attributes": {"status": "ARCHIVED"}}}
    ),

    # 7. Work with nested resources
    applicantâ‰œopengov_api.get_record_applicant("record-123"),
    guestsâ‰œlist(opengov_api.iter_record_guests("record-123")),

    # 8. Error handling
    try{
      recordâ‰œopengov_api.get_record("invalid-id")
    }catch opengov_api.NotFound{
      print("Record not found")
    }
  }

  ;; List All Records Pattern
  list_allâ‰œ{
    all_recordsâ‰œ[],
    for record in opengov_api.iter_records(){
      all_records.append(record)
    },
    # Or: all_records = list(opengov_api.iter_records())
  }

  ;; Filter Pattern
  filter_patternâ‰œ{
    active_permitsâ‰œ[
      r for r in opengov_api.iter_records(
        status="ACTIVE",
        type_id="permit-type-123"
      )
    ]
  }

  ;; Nested Resource Pattern
  nestedâ‰œ{
    record_idâ‰œ"record-123",

    # Get applicant
    applicantâ‰œopengov_api.get_record_applicant(record_id),

    # List guests
    guestsâ‰œopengov_api.list_record_guests(record_id),

    # Add guest
    new_guestâ‰œopengov_api.add_record_guest(
      record_id,
      {"data": {"type": "users", "id": "user-456"}}
    ),

    # Iterate workflow steps
    for step in opengov_api.iter_record_workflow_steps(record_id){
      print(f"{step['kind']}: {step['status']}")
    }
  }
}

;; â”€â”€â”€ Î£: JSON:API FORMAT â”€â”€â”€
âŸ¦Î£:JSONAPIâŸ§{
  ;; Request Format
  Requestâ‰œ{
    "data": {
      "type": "records",           # Resource type
      "id": "123",                 # For updates (optional for create)
      "attributes": {              # Resource attributes
        "name": "value",
        "status": "ACTIVE"
      },
      "relationships": {           # Related resources (optional)
        "applicant": {
          "data": {"type": "users", "id": "456"}
        }
      }
    }
  }

  ;; Response Format
  Responseâ‰œ{
    "data": {                      # Or array for collections
      "id": "123",
      "type": "records",
      "attributes": {...},
      "relationships": {...}
    },
    "meta": {                      # Optional metadata
      "total": 100,
      "page": 1
    },
    "links": {                     # Optional pagination links
      "next": "?page=2",
      "prev": "?page=1"
    }
  }

  ;; Accessing Response Data
  accessâ‰œ{
    responseâ‰œlist_records(),
    recordsâ‰œresponse["data"],              # List of resources
    first_recordâ‰œrecords[0],
    record_idâ‰œfirst_record["id"],
    record_nameâ‰œfirst_record["attributes"]["name"],
    totalâ‰œresponse["meta"]["total"]
  }
}

;; â”€â”€â”€ Î•: EVIDENCE â”€â”€â”€
âŸ¦Î•âŸ§âŸ¨
packageâ‰œopengov-api
versionâ‰œ1.0.0+
pythonâ‰œ3.14+
dependenciesâ‰œhttpxâ‰¥0.28.1,pydanticâ‰¥2.12.5
patternâ‰œfunctional_factory
configâ‰œmodule_level_state
httpâ‰œhttpx.Client
formatâ‰œJSON:API
|endpoints|â‰œ50+
|resources|â‰œrecords,users,locations,documents,record_types
coverageâ‰œâ‰¥98%
type_safetyâ‰œcomplete
âŠ¢production_ready
âŸ©

;; â”€â”€â”€ APPENDIX: AISP NOTATION REFERENCE â”€â”€â”€
âŸ¦Appendix:AISPâŸ§{
  ;; Core Symbols
  â‰œ defas (defined as)
  â‰” assign
  â‰¡ identical/equals
  â‡’ implies
  â†’ function type arrow (input â†’ output)
  Î» lambda function
  âˆ€ for all
  âˆƒ exists
  âˆˆ element of
  âŠƒ superset/parent class
  âˆ§ and
  âˆ¨ or
  Â¬ not
  âŠ¤ true
  âŠ¥ false/error
  âˆ… empty/null

  ;; Type Symbols
  ğ”¹ boolean
  â„• natural number (int)
  â„ real number (float)
  ğ•Š string
  ? optional (suffix)

  ;; Structural Symbols
  âŸ¨âŸ© tuple/record
  âŸ¦âŸ§ block/section
  {} set/object
  [] list/array
  | or/union type

  ;; Block Types
  âŸ¦Î©âŸ§ meta-logic, foundation
  âŸ¦Î£âŸ§ glossary, types
  âŸ¦Î“âŸ§ rules, patterns
  âŸ¦Î›âŸ§ functions, API
  âŸ¦Î§âŸ§ errors (optional)
  âŸ¦Î•âŸ§ evidence, metadata

  ;; Reading Guide
  Pattern: HeaderBlock â‰« Glossary â‰« Types â‰« Rules â‰« Functions â‰« Evidence

  Example_Function:
    list_records:ListParams?â†’JSONAPIResponse[ListâŸ¨RecordâŸ©]
    #           ^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    #           parameters   return type
    #           ? = optional

  Example_Definition:
    Recordâ‰œâŸ¨id:ğ•Š,name:ğ•Š,status:RecordStatusâŸ©
    #      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    #      tuple with named fields and types

  Example_Rule:
    âˆ€operation:requires(api_key)âˆ§requires(community)
    # For all operations: requires api_key AND requires community
}
